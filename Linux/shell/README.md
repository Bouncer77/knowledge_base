# Основные операторы языка интерпритатора Shell

Основная реализация интерпритотаро это `Bash shell`

Команды оболочки `Bash` входят в стандарт `POSIX`, т.е. реализованы в любой Unix-подобной ОС.

Приглашение обозначается символом:

1. `$` для обычных пользователей
2. `#` для root

## Учетная запись

`sudo -i`, `su` - стать суперпользователем


### passwd

Сменить пароль от учетной записи

```bash
passwd [новый_пароль]
```

### exit

Завершение работы

```bash
# или Ctrl+D
exit
```

## Сочетания клавиш

Hotkey                    | Назначение
--------------------------|------------------------------------
Ctrl+D                    | exit
Shift+PageUp/PageDown     | прокрутить экран вверх/вниз
Tab                       | дополнить название команды
Tab x2                    | вывести доступные названия команд или файлов
Ctrl/Shift+Insert         | копировать/вставить
Ctrl+R                    | искать по истории выполненных команд
Win+Space                 | переключение раскладки

## Help

```bash
# shell информация
man pwd

# Спавочная информация из оболочки bash
help pwd
```

## Виртуальные консоли

Позволяют войти в систему под несколькими именами в одно время

## Переменные среды

Переменные среды                  | Уровень
----------------------------------|---------------------------------
/etc/profile                      | Переменные среды - ОС
~/.bash_profile                   |                  - Пользователь
/etc/bashrc                       | Псевдонимы (alias) - ОС
~/.bashrc                         |                    - Пользователь

## Простые команды

Команда               | Значение
----------------------|--------------------------------
hostname [-i]         | Определить имя машины , [-i] - IP-address
uname [-m]            | Тип системы (Linux), [-m] - архитектура (x86_64), [-r] - print the kernel release 
lscpu                 | Информация о процессоре


### Создание псевдонимов (alias)

`~/.bashrc` - Каждый раз выполняется при запуске терминала

alias c='clear' | Создать alias на сеанс
с               | Использование
unalias c       | Удалить alias      


```bash
alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l.='ls -d .* --color=auto'
alias ll='ls -l --color=auto'
alias ls='ls --color=auto'
alias mc='. /usr/libexec/mc/mc-wrapper.sh'
alias sup='sudo su postgres'
alias which='alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde'

alias c='clear'
alias ports='netstat -tulanp'
```

## Строка приглашения

[PR1](https://meliorem.ru/tools/linux/kak-izmenit-format-stroki-priglasheniya-v-terminale-linux/)



```bash
#Вывести формат строки приглашения
echo $PS1

#bash-4.2$ echo $PS1
#\s-\v\$


#[oleg@meliorem ~]# echo $PS1
#[\u@\h \W]\$

# PS1="\e[1;38;5;48m\u@\h\e[m:\e[1;38;5;45m\w\e[m\n\\$ "
```

# Изменить оболочку

`chsh -l`  - вывести список оболочек

```
postgres@nt-pgsql:~$ chsh -l
/bin/sh
/bin/bash
/usr/bin/sh
/usr/bin/bash
```

# Сохранение формата строки приглашения на постоянной основе

1. `/etc/bashrc` или `/etc/profile.d/<название>.sh` - для всех пользователей. Перезапуск оболочки bash - `exec bash`
2. `~/.bashrc` - для пользователя. Перезапуск - `source ~/.bashrc`

Спецсимволы:

+ \u - (user) имя текущего пользователя.
+ \h - (host) имя текущего хоста.
+ \W - (working directory) путь к рабочему каталогу (каталог, где сейчас находится пользователь).
+ \\$ - тип пользователя (# - для root, $ - для обычных пользователей).

Простые экранируемые символы:

+ \a - звуковой сигнал (ASCII: 07)
+ \e - символ escape-последовательности
+ \" - двойные кавычки
+ \\ - обратный слэш
+ \n - новая строка
+ \r - возврат каретки (курсора) на начало строки
+ \[- начало последовательности непечатных символов
+ \] - конец последовательности непечатных символов
+ \nnn - восьмеричный код символа (\113 -> K)

Вывод даты и времени

+ \d - дата в формате "день недели месяц число"
+ \D{формат даты} - дата в указанном формате, например \D{%d.%m.%Y}
+ \@ - время в 12 часовом  формате "часы:минуты AM\PM"
+ \A - время в 24 часовом  формате "часы:минуты"
+ \t - время в 24 часовом  формате "часы:минуты:секунды"
+ \T - время в 12 часовом  формате "часы:минуты:секунды

Вывод системной информации

+ \h - имя хоста до первой точки
+ \H - полное имя хоста
+ \j - количество работ (jobs), выполняемых в терминале (скрытых после нажатия Ctrl+Z)
+ \s - имя текущей оболочки (вывод значения переменной - $0)
+ \u - имя текущего пользователя
+ \v - версия оболочки BASH
+ \V - более детальная версия оболочки BASH
+ \w - полный путь к текущей директории
+ \W - имя текущей директории
+ \! - номер текущей команды в истории команд
+ \# - номер текущей команды за период сессии
+ \\$ - тип пользователя (# - для root, $ - для всех остальных)

### Раскрасить строку приглашения

[Статья](https://meliorem.ru/tools/linux/kak-izmenit-cvet-teksta-stroki-priglasheniya-v-terminale-linux/)

	Иногда использование непечатных символов таких как \e может привести к некорректному поведению строки приглашения, особенно при пролистывании истории команд кнопкой вверх. В связи с этим крайне рекомендуется экранированить все непечатные символы с помощью - \[  \].

`PS1="\[\e[1;92m\]\u@\h\[\e[m\]:\[\e[1;96m\]\w\[\e[m\]\\$ "`

Существуют терминалы, которые поддерживают следующее количество цветов:

+ 8 цветов - для 3 битной версии управляющих символов ANSI, поддерживается почти всеми терминалами.
+ 16 цветов - для 4 битной версии управляющих символов ANSI, поддерживается почти всеми терминалами.
+ 88 цветов -  для 7 битной версии управляющих символов ANSI, поддерживается многими современными терминалами.
+ 256 цветов - для 8 битной версии управляющих символов ANSI, поддерживается многими современными терминалами.
+ 16777216 цветов - для 24 битной версии управляющих символов ANSI, поддерживается только терминалами в современных графических оболочках.

`tput colors` - Узнать сколько цветов поддерживает терминал

PS1="\e[1;38;5;48m\u@\h\e[m:\e[1;38;5;45m\w\e[m\n\\$ "

Непечатных символы:

+ \e[ - начало форматирования текста.
+ x;y;zm - код цвета (x = код форматирования, y = код цвета текста, z = код цвета фона). Порядок следования x,y и z не имеет значения, т.к. код определяется по числовому значению, а не по его положению.
+ \e[m - конец форматирования текста (необязателен, нужен для сброса форматирования).

> Непечатные символы надо экранировать `\[  \]`

```bash
PS1="\[\e[1;96m\]\u@\[\e[1;91m\]\h\[\e[m\]:\[\e[1;92m\]\w\[\e[1;97m\]\\$[\e[m\]"
```

# Общение

`mesg` - включение/выключение отправки прямых сообщений на терминал пользователя

`who` - список пользователей находящихся в системе

# Группы

`id` - информация о текущем пользователе

+ uid - уникальный номер пользователя в системе

+ gid - номер основной группы, к которой относится пользователь

# Размер Иерархия

`du` - аналог `tree` , `find`, `ls -R`

`du -BM /dir` - размер файлов в мебибитах. Мебибит содержит 1048576 (2^20) бит.

`wc <имя_файла>` - строки (-l), слова (-w), биты (-c), название файла

# Пути

Пути:

1. Абсолютный

	+ `/home/student/dir2/file`

2. Относительный:

	+ `~/dir2/file` - относительно домашней директории (strudent)
	+ `../dir2/file` - относительно директории `/home/student/dir1`


# ls

`ls -l` - сокращение от list - ls

drwxr-xr-x 2 postgres postgres  6 Feb  5 21:02 dir7
-rw-r--r-- 1 postgres postgres  0 Feb  5 21:05 file1.txt

1. d, -, l, c, b, s, p

	+ `d` - каталог
	+ `-` - простой файл
	+ `l` - символьная ссылка
	+ `c` - символьное устройство
	+ `b` - блочное устройство
	+ `s` - сокет
	+ `p` - канал

2. Права доступа к файлу

3. Количество ссылок на файл

4. Имя владельца

5. Имя группы владельца

6. Размер файла в байтах

7. Временной штамп

8. Имя файла

# Канал

Канал = символ `|` в bash - связь между потоками. 

Поток вывода `stdout` из одного процесса может быть связан с потоком ввода `stdin` другого процесса. 

# Редактор

`fc`
или
`Ctrl+X+E`

`EDITOR="vi"` в `~/.bashrc` (перезагрузить `source ~/.bashrc`)

Открывает текстовый редактор, чтобы написать длинную команду.

Писать можно на ваше усмотрение в vi, emacs, nano... Комбинация клавиш захватывает написанный текст и открывает его в редакторе, задаваемом в $EDITOR.

# Очистить терминал

`Ctrl-L`

Просто очищает терминал.